/*! L2JS v0.1.0 | Copyright 2014, 2014 Tomáš Konrády (tomas.konrady@uhk.cz). | MIT licence */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?b(a,!0):b(a)}(this,function(window){var _l2js=l2js,l2js=window.l2js=window.l2js||(window.l2js={});l2js.options={keepDerivations:!1,maxDerivedSymbols:5e3},window.l2js.files={},l2js.core=l2js.core||{},l2js.core.Promise=function a(b){this.deferred=b},l2js.core.Promise.prototype.then=function(a,b){return this.deferred.successCallback=a,this.deferred.errorCallback=b,this.result=l2js.core.q.deferred(),this.result.promise},l2js.core.Promise.prototype.catch=function(a){this.deferred.errorCallback=a},l2js.core.Deferred=function(){this.promise=new l2js.core.Promise(this)},l2js.core.Deferred.prototype.reject=function(a){this.errorCallback&&this.promise.result.reject(this.errorCallback(a)||a)},l2js.core.Deferred.prototype.resolve=function(a){this.successCallback&&this.promise.result.resolve(this.successCallback(a)||a)},l2js.core.q={deferred:function(){return new l2js.core.Deferred}},function(){function a(a,b,c){return"undefined"==typeof c||0===+c?Math[a](b):(b=+b,c=+c,isNaN(b)||"number"!=typeof c||c%1!==0?0/0:(b=b.toString().split("e"),b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c))),b=b.toString().split("e"),+(b[0]+"e"+(b[1]?+b[1]+c:c))))}Math.round10||(Math.round10=function(b,c){return a("round",b,c)}),Math.floor10||(Math.floor10=function(b,c){return a("floor",b,c)}),Math.ceil10||(Math.ceil10=function(b,c){return a("ceil",b,c)})}(),l2js.utils={copy:function(a){if(l2js.utils.isUndefined(a)||"object"!=typeof a||null===a)return a;var b=new a.constructor;for(var c in a)b[c]=l2js.utils.copy(a[c]);return b},hasProp:{}.hasOwnProperty,extend:function(a,b){for(var c in b)l2js.utils.hasProp.call(b,c)&&(a[c]=b[c]);function d(){this.constructor=a}return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},indexOf:function(a,b,c){c||(c=0);var d=a.length;for(0>c&&(c=d+c);d>c;c++)if(a[c]===b)return c;return-1},isUndefined:function(a){return"undefined"==typeof a},isFunction:function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},toUpperFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},padLeft:function(a,b,c){while(a.length<c)a=b+a;return a},normalizeAngle:function(a){var b=a%360;return 0>a?360+b:b},HSVToRGB:function(a){var b=l2js.utils.normalizeAngle(a.h)/360,c=a.s<0?0:a.s>1?1:a.s,d=a.v<0?0:a.v>1?1:a.v,e,f,g,h=Math.floor(6*b),i=6*b-h,j=d*(1-c),k=d*(1-i*c),l=d*(1-(1-i)*c);switch(h%6){case 0:e=d,f=l,g=j;break;case 1:e=k,f=d,g=j;break;case 2:e=j,f=d,g=l;break;case 3:e=j,f=k,g=d;break;case 4:e=l,f=j,g=d;break;case 5:e=d,f=j,g=k}return{model:"rgb",r:255*e,g:255*f,b:255*g,a:a.a}},RGBToInt:function(a){function b(a){return!a||0>a?0:a>255?255:a}var c=b(a.r)||0;return c<<=8,c|=b(a.g),c<<=8,c|=b(a.b),c<<=8,c|=b(a.a),c>>>=0,c/4294967295},colorToHexString:function(a){function b(a){return parseInt(a,16)}var c=l2js.utils.padLeft(Math.round(4294967295*a).toString(16),0,8);return{hex:"#"+c.substring(0,6),r:b(c.substring(0,2)),g:b(c.substring(2,4)),b:b(c.substring(4,6)),a:b(c.substring(6,8))/256}}},l2js.compiler=l2js.compiler||{},l2js.compiler.env=l2js.compiler.env||{},l2js.compiler.env.Alphabet=function(){function a(a,b){this.id=a,this.symbols=b,this.type="alphabet"}return a.prototype.hasSymbol=function(a){return this.symbols||a?this.symbols&&a&&-1!==l2js.utils.indexOf(this.symbols,a):!1},a}(),l2js.compiler.env.SubLSystem=function(){function a(a,b,c,d){this.ctx=a,this.lsystem=b,"number"==typeof c&&(d=c,c=void 0),this.axiom=c,this.maxIterations=d,this.type="sublsystem"}return a.prototype.derive=function(){var a;return this.lsystemInst||(this.lsystemInst=new this.lsystem(this.ctx)),this.derivation?a=this.lsystemInst.derive(this.derivation,this.maxIterations):(a=this.lsystemInst.derive(this.axiom,this.maxIterations),this.axiom=a.axiom),this.derivation=a.derivation,this.interpretation=a.interpretation,this},a}(),l2js.compiler.env.Stack=function(){function a(a,b,c){this.start=a,this.end=b,this.string=c,this.type="stack"}return a}(),l2js.compiler.env.LSystem=function(a){function b(b,c){this.ctx=b?a.utils.copy(b):{},this.rulesProbabilities={},this.type="lsystem"}return b.prototype.checkAlphabetSymbol=function(a){},b.prototype.derive=function(b,c){0===arguments.length?(b=this.axiom(),c=this.maxIterations):1===arguments.length?"number"==typeof b?(c=arguments[0],b=this.axiom()):c=this.maxIterations:2===arguments.length&&(b=b||this.axiom(),c=a.utils.isUndefined(c)?this.maxIterations:c);var d,e=c+1,f={axiom:b,totalIterations:c,derivations:[],interpretations:[]};for(d=0;e>d;d++)f.derivation=f.derivation?this.deriveString(f.derivation,"-"):b,f.interpretation=this.deriveString(f.derivation,"h"),a.options.keepDerivations&&(f.derivations.push(a.utils.copy(f.derivation)),f.interpretations.push(a.utils.copy(f.interpretation)));return f},b.prototype.deriveString=function(b,c){var d=[],e;for(e=0;e<b.length;e++){if(a.utils.isUndefined(b[e]))throw Error("Undefined ancestor.");if(this.ctx.stats.numberOfDerivedSymbols++,this.ctx.stats.numberOfDerivedSymbols>a.options.maxDerivedSymbols)throw new Error("Reached the limit of maximum derived symbols per derivation of script.");if(b[e]instanceof a.compiler.env.SubLSystem)"-"===c&&d.push(a.utils.copy(b[e]).derive())||d.push(a.utils.copy(b[e]));else if(b[e]instanceof a.compiler.env.Stack)d.push(new a.compiler.env.Stack(b[e].start,b[e].end,this.deriveString(b[e].string,c)));else{var f=b[e];this.checkAlphabetSymbol(f.symbol),d=d.concat(this.findDerivation(f,c))}}return d},b.prototype.findDerivation=function(c,d){var e=b.makeHash(c,d);if(!a.utils.isUndefined(this.rules[e])){var f=this.rules[e],g;if(a.utils.isUndefined(this.rulesProbabilities[e]))for(this.rulesProbabilities[e]=0,i=0;i<f.length;i++)g=f[i],this.rulesProbabilities[e]+=g.probability;if(0!==this.rulesProbabilities[e]){var h=Math.random()*this.rulesProbabilities[e],i,j=0;for(i=0;i<f.length;i++)if(g=f[i],j+=g.probability,j>=h)return g.successor.apply(this,c.arguments)}}return[c]},b.makeHash=function(b,c){var d=b.arguments||b.params||[],e="";a.utils.isUndefined(c)&&(c="-");var f;for(f=0;f<d.length;f++)e+=a.utils.isUndefined(d[f])?0:1;return c+"@"+e+"_"+b.symbol},b.getModule=function(a,b,c){return{alphabet:c.id,symbol:a,arguments:b}},b.getParamModule=function(a,b,c){return{alphabet:c.id,symbol:a,params:b}},b.id="",b.alphabet={},b}(l2js),l2js.compiler.env.LScript=function(){function a(a){this.ctx=l2js.utils.copy(a),this.type="lscript"}return a.prototype.derive=function(a,b){this.ctx.stats.numberOfDerivedSymbols=0;var c=new this.main(this.ctx);return c.derive(a||this.axiom,b||this.maxIterations)},a}(),l2js.compiler.env.SubLScript=function(){function a(a,b,c){this.lscript=a,this.axiom=b,this.maxIterations=c,this.type="sublscript"}return a.prototype.derive=function(){throw"No implementation"},a}(),l2js.compile=function(a){return(new l2js.compiler.Compiler).compile(a)},l2js.derive=function(lsystemCode){var out=eval(lsystemCode);return out},l2js.interpretAll=function(a,b){new l2js.interpret.Interpret(a,b).all()},l2js.format=function(a){var b=l2js.core.q.deferred();return setTimeout(function(){var c=function(a){b.reject(a)};try{var d=new l2js.compiler.Compiler,e=d.toAST(a),f=d.ASTToL2(e);b.resolve(f)}catch(g){c(g)}},0),b.promise},l2js.evolve=function(a,b,c,d){for(var e=new l2js.compiler.Compiler,f=[],g=0;g<b.length;g++){"string"==typeof b[g]&&(b[g]={code:b[g]});var h=e.toAST(b[g].code);f.push({evaluation:b[g].evaluation||0,ast:h})}return new l2js.evolver.Evolver(f,{numberOfIndividuals:a,lsystems:d,lscript:c})}});
//# sourceMappingURL=dist/l2js.min.map